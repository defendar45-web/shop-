{% extends 'base/base.html' %}

{% block content %}

<div class="min-h-screen py-14 px-4">
  <div class="max-w-7xl mx-auto">

    <!-- Header -->
    <div class="mb-10 text-left">
      <h1 class="text-4xl font-semibold text-gray-900">
        –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
      </h1>
      <p class="text-gray-500 mt-2">
        –í—ã –∏—Å–∫–∞–ª–∏:
        <span class="font-medium text-gray-800">¬´{{ query }}¬ª</span>
      </p>
    </div>

    {% if products %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">

      {% for product in products %}
      <div class="relative group bg-white rounded-3xl shadow-sm hover:shadow-md transition h-[400px] p-6 flex flex-col items-center">

        <!-- Favorite Button -->
        {% if user.is_authenticated %}
        <form method="post" action="{% url 'toggle_favorite' product.id %}" class="absolute top-4 right-4 z-10">
          {% csrf_token %}
          <button type="submit"
                  class="w-10 h-10 rounded-full flex items-center justify-center transition
                         {% if product.id in favorites %}
                           bg-red-500 text-white
                         {% else %}
                           bg-white text-gray-400 hover:text-red-500
                         {% endif %}">
            ‚ô•
          </button>
        </form>
        {% endif %}

        <!-- Image -->
        <div class="w-[180px] h-[180px] flex items-center justify-center mb-4">
          <img src="{{ product.get_image }}" alt="{{ product.name }}"
               class="w-full h-full object-contain group-hover:scale-105 transition duration-300">
        </div>

        <!-- Name -->
        <div class="text-center flex-1 w-full">
          <h2 class="text-[15px] font-semibold text-gray-900 uppercase leading-snug break-words line-clamp-2 overflow-hidden">
            {{ product.name }}
          </h2>
        </div>

        <!-- Price + Add to Cart -->
        <div class="mt-4 w-full flex flex-col items-center gap-3">

          <span class="text-[20px] font-semibold text-gray-900">
            {{ product.price|floatformat:0 }} ‚ÇΩ
          </span>

          <form method="post" action="{% url 'add_to_cart' product.id %}" class="w-full">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            <button type="submit"
                    class="w-full h-[44px] rounded-full bg-[#00BEA2] text-white font-semibold hover:bg-[#05B197] transition shadow-sm">
              –í –∫–æ—Ä–∑–∏–Ω—É
            </button>
          </form>

        </div>

      </div>
      {% endfor %}

    </div>

    {% else %}
    <!-- Empty state -->
    <div class="col-span-full">
      <div class="p-14 text-center">

        <div class="text-6xl mb-4">üõí</div>

        <h2 class="text-2xl font-semibold text-gray-900 mb-3">
          –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        </h2>

        <p class="text-gray-500 mb-8 max-w-md mx-auto">
          –ú—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–∞—Ç–∞–ª–æ–≥–∞.
          –ó–∞–≥–ª—è–Ω–∏—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
        </p>

        <div class="flex justify-center">
          <a href="{% url 'categories' %}"
             class="inline-block h-[44px] px-[30px]
                    rounded-full
                    bg-[#00BEA2] text-white
                    text-[14px] font-semibold
                    hover:bg-[#05B197]
                    transition shadow-sm">
            –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥
          </a>
        </div>
      </div>
    </div>
    {% endif %}

  </div>
</div>

{% endblock %}

