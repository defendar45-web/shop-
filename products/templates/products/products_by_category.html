{% extends 'base/base.html' %}
{% block content %}

<div class="min-h-screen py-14 px-4">
  <div class="max-w-7xl mx-auto">

    <!-- Category Title + Back Link -->
    <div class="mb-8">
      <!-- Back Link with arrow -->
      <a href="{% url 'categories' %}"
         class="inline-block mb-2 text-sm text-gray-500 hover:text-gray-700 transition">
        ← Вернуться в каталог
      </a>

      <!-- Category Name -->
      <h1 class="text-3xl font-bold text-gray-800">
        {{ category.name }}
      </h1>
    </div>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">

      {% for product in products %}
      <div class="relative group">

        <!-- FAVORITE BUTTON -->
        <form method="post"
              action="{% url 'toggle_favorite' product.id %}"
              class="absolute top-4 right-4 z-10">
          {% csrf_token %}
          <button type="submit"
                  class="w-10 h-10 rounded-full
                         flex items-center justify-center
                         transition
                         {% if product.id in favorites %}
                           bg-red-500 text-white
                         {% else %}
                           bg-white text-gray-400 hover:text-red-500
                         {% endif %}">
            ♥
          </button>
        </form>

        <!-- CARD -->
        <a href="{% url 'product_detail' product.slug %}" class="block">

          <div class="bg-white rounded-3xl shadow-sm hover:shadow-md transition
                      h-[420px] p-6 flex flex-col items-center">

            <!-- Image -->
            <div class="w-[180px] h-[180px] flex items-center justify-center mb-4">
              <img src="{{ product.get_image }}"
                   alt="{{ product.name }}"
                   onerror="this.src='/static/img/no_image.png'"
                   class="w-full h-full object-contain
                          group-hover:scale-105 transition duration-300">
            </div>

            <!-- Name -->
            <div class="text-center flex-1 w-full">
              <h2 class="text-[15px] font-semibold text-gray-900 uppercase
                         leading-snug break-words line-clamp-3">
                {{ product.name }}
              </h2>
            </div>

            <!-- Price + Button -->
            <div class="mt-4 w-full flex flex-col items-center gap-3">
              <span class="text-[20px] font-bold text-gray-900">
                {{ product.price|floatformat:0 }} ₽
              </span>

              <form method="post"
                    action="{% url 'add_to_cart' product.id %}"
                    class="w-full">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.path }}">
                <button type="submit"
                        class="w-full h-[44px] rounded-full
                               bg-[#00BEA2] text-white font-semibold
                               hover:bg-[#05B197] transition shadow-sm">
                  В корзину
                </button>
              </form>
            </div>

          </div>
        </a>
      </div>

      {% empty %}
      <!-- Empty category notification -->
      <div class="col-span-full">
        <div class="p-14 text-center">

          <h2 class="text-3xl font-bold text-gray-800 mb-3">
            В этой категории пока нет товаров
          </h2>

          <p class="text-gray-500 mb-8 max-w-md mx-auto">
            Мы уже работаем над наполнением каталога.
            Загляните позже или посмотрите другие категории.
          </p>

          <div class="flex justify-center">
            <a href="{% url 'categories' %}"
               class="inline-block h-[44px] px-[30px]
                      rounded-full
                      bg-[#00BEA2] text-white
                      text-[14px] font-semibold
                      hover:bg-[#05B197]
                      transition shadow-sm">
              Вернуться в каталог
            </a>
          </div>
        </div>
      </div>
      {% endfor %}

    </div>

  </div>
</div>

{% endblock %}
